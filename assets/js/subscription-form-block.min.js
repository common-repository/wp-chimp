!function(){"use strict";function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(l,e,m,t,n,o,s,r){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function f(i){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?p(o,!0).forEach(function(e){var t,n,r;t=i,r=o[n=e],n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):p(o).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(o,e))})}return i}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}n=n&&n.hasOwnProperty("default")?n.default:n;function y(e){var t=e.list_id;return l.createElement("div",{key:"form-undefined",className:"wp-chimp-notice wp-chimp-notice--error"},l.createElement(l.RawHTML,{key:"form-undfined-content",className:"wp-chimp-notice__content"},r.sprintf(r.__("One or some of the required data property, such as the %s, %s, and %s text, could not be retrieved from the selected MailChimp List. Please head to %s, and verify that the selected MailChimp List, %s, is actually present on this site.","wp-chimp"),"<strong>".concat(r.__("Heading","wp-chimp"),"</strong>"),"<strong>".concat(r.__("Email Placeholder","wp-chimp"),"</strong>"),"<strong>".concat(r.__("Button","wp-chimp"),"</strong>"),'<a href="'.concat(S,'" target="_blank" class="wp-chimp-notice__url">').concat(r.__("the Settings page","wp-chimp"),"</a>"),"<code>".concat(t,"</code>"))))}function v(){return l.createElement("div",{key:"form-inactive",className:"wp-chimp-notice wp-chimp-notice--warning"},l.createElement(l.RawHTML,{key:"form-inactive-content",className:"wp-chimp-notice__content"},r.sprintf(r.__("Subscription Form is currently inactive. You might haven't yet input the MailChimp API key to %1$s or your MailChimp account might not contain a %2$s.","wp-chimp"),'<a href="'.concat(P,'" target="_blank" class="wp-chimp-notice__url">').concat(r.__("the Settings page","wp-chimp"),"</a>"),'<a href="https://kb.mailchimp.com/lists" target="_blank" class="wp-chimp-notice__url">'.concat(r.__("List","wp-chimp"),"</a>"))))}var g={subscriptionForms:[],notice:{status:null,message:null}},w={fetchFromAPI:function(e){return{type:"FETCH_FROM_API",path:e}},postToAPI:function(e,t){return{type:"POST_TO_API",path:e,body:t}},setAll:function(e){return{type:"SET_ALL",subscriptionForms:e}},setItem:function(e){return{type:"SET_ITEM",item:e}},setIsSaving:function(e){return{type:"SET_STATUS",status:{isSaving:e}}},unSetNotice:function(){return{type:"SET_NOTICE",notice:{status:null,message:null}}},setNotice:function(e,t){return{type:"SET_NOTICE",notice:{status:e,message:t}}},saveItem:regeneratorRuntime.mark(function e(t){var n,r,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=Object.keys(t.attributes),i=0;case 3:if(!(i<r.length)){e.next=12;break}if(o=r[i],m.has(t.attributes,o)){e.next=7;break}return e.abrupt("continue",9);case 7:"list_id"===o&&(n[o]=t.attributes[o]),m.has(t.attributes[o],"value")&&(n[o]=t.attributes[o].value);case 9:i++,e.next=3;break;case 12:return e.next=14,w.postToAPI("/wp-chimp/v1/subscription-forms/".concat(n.list_id),n);case 14:return s=e.sent,e.abrupt("return",w.setItem(s));case 16:case"end":return e.stop()}},e)})},E={FETCH_FROM_API:function(e){return n({path:e.path})},POST_TO_API:function(e){return n({path:e.path,method:"POST",body:JSON.stringify(e.body)})}},O={getAll:regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.fetchFromAPI("/wp-chimp/v1/subscription-forms");case 2:return t=e.sent,e.abrupt("return",w.setAll(t));case 4:case"end":return e.stop()}},e)}),getItem:regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.fetchFromAPI("/wp-chimp/v1/subscription-forms/".concat(t));case 2:return n=e.sent,e.abrupt("return",w.setItem(n));case 4:case"end":return e.stop()}},e)})},S=(t.registerStore("wp-chimp/subscription-forms",{reducer:function(e,t){var n=0<arguments.length&&void 0!==e?e:g,r=1<arguments.length?t:void 0;switch(r.type){case"SET_ALL":return f({},n,{subscriptionForms:r.subscriptionForms});case"SET_ITEM":return m.includes(m.map(n.subscriptionForms,"list_id"),r.item.list_id)?f({},n,{subscriptionForms:n.subscriptionForms.map(function(e){return e.list_id===r.item.list_id?f({},r.item):e})}):(n.subscriptionForms.push(r.item),f({},n,{subscriptionForms:n.subscriptionForms}));case"SET_STATUS":return f({},n,{},r.status);case"SET_NOTICE":return f({},n,{notice:r.notice})}return n},actions:w,selectors:{getAll:function(e){return e.subscriptionForms||{}},getItem:function(e,t){for(var n,r=0;r<e.subscriptionForms.length;r++)e.subscriptionForms[r].list_id===t&&(n=e.subscriptionForms[r]);return n||{}},getStatus:function(e){return{isSaving:e.isSaving}},getNotice:function(e){return{notice:e.notice}}},controls:E,resolvers:O}),wpChimpInlineState.settingsUrl),k=function(){function e(){return i(this,e),d(this,b(e).apply(this,arguments))}return h(e,l.Component),a(e,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.attributes,r=e.marketing_permissions,i=n||{},o=i.text_heading,s=i.text_sub_heading,c=i.text_email_placeholder,a=i.text_marketing_permissions,u=i.text_button,p=i.text_footer;return m.isUndefined(n)||m.some(n,m.isUndefined)?l.createElement(y,this.props.attributes):l.createElement("div",{className:"".concat(t)},l.createElement("header",{className:"".concat(t,"__header")},l.createElement("h3",{className:"".concat(t,"__heading")},!m.isEmpty(o.value)&&o.value),!m.isEmpty(s.value)&&l.createElement("div",{className:"".concat(t,"__sub-heading")},s.value)),l.createElement("div",{className:"".concat(t,"__form wp-chimp-form")},l.createElement("div",{className:"wp-chimp-form-fields"},l.createElement("input",{className:"wp-chimp-form-fields__item wp-chimp-form-fields-email",type:"email",placeholder:!m.isEmpty(c.value)&&c.value,disabled:!0}),!0===r&&!m.isEmpty(a.value)&&l.createElement("div",{className:"wp-chimp-form-fields__item wp-chimp-form-fields-checkbox"},l.createElement("input",{type:"checkbox",id:"".concat(n.list_id,"_marketing_permissions")}),l.createElement("label",{htmlFor:"".concat(n.list_id,"_marketing_permissions")},a.value))),l.createElement("button",{className:"wp-chimp-form-button",type:"button"},!m.isEmpty(u.value)&&u.value)),!m.isEmpty(p.value)&&l.createElement("div",{className:"".concat(t,"__footer")},p.value))}}]),e}(),T=function(){function e(){return i(this,e),d(this,b(e).apply(this,arguments))}return h(e,l.Component),a(e,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.attributes,r=e.setAttributes,i=e.subscriptionForms;return l.createElement("div",{className:"".concat(t,"__select-list")},l.createElement("select",{value:n.list_id,onChange:function(e){return r({list_id:e.target.value?e.target.value:n.list_id})}},i.map(function(e,t){var n=e.list_id,r=e.name;return l.createElement("option",{value:n,key:t},r)})))}}]),e}(),P=wpChimpInlineState.settingsUrl,N=function(){function e(){return i(this,e),d(this,b(e).apply(this,arguments))}return h(e,l.Component),a(e,[{key:"render",value:function(){var t=this,e=this.props,n=e.className,r=e.subscriptionForms;if(m.isUndefined(r)||m.isObject(r)&&0===m.size(r))return l.createElement(s.Placeholder,{className:"wp-chimp-placholder is-loading"},l.createElement(s.Spinner,null));if(m.size(r)<1)return l.createElement(v,null);var i=r.find(function(e){return e.list_id===t.props.attributes.list_id})||{};return l.createElement(l.Fragment,null,l.createElement(o.BlockControls,{key:"form-controls",className:"".concat(n,"__block-controls")},l.createElement(s.Toolbar,{key:"form-toolbar"},l.createElement(T,this.props))),l.createElement(k,u({className:n},i)))}}]),e}(),F=t.withSelect(function(e){var t=e("wp-chimp/subscription-forms").getAll();return t?{subscriptionForms:t}:{}})(N),I=wpChimpInlineState.mailchimpApiStatus;e.registerBlockType("wp-chimp/subscription-form",{icon:l.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24"},l.createElement("g",null,l.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),l.createElement("path",{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 4.99L4 6h16zm0 12H4V8l8 5 8-5v10z"}))),edit:function(e){return!0!==function(){var e=wpChimpInlineState.restApiUrl;return"undefined"!=typeof wpChimpInlineState&&!(void 0===e||!/\/wp-json\//.test(e))}()||!0!==I?l.createElement(v,null):l.createElement(F,u({},e,{className:"wp-chimp-subscription-form"}))},save:function(e){return e.attributes.list_id?'[wp-chimp list_id="'.concat(e.attributes.list_id,'"]'):"[wp-chimp]"}})}(wp.element,wp.blocks,lodash,wp.data,wp.apiFetch,wp.editor,wp.components,wp.i18n)}();
//# sourceMappingURL=subscription-form-block.min.js.map
