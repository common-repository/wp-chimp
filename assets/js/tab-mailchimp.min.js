!function(){"use strict";function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(h,d,e,s,i,_,f,a,t,r){function o(e,t,n,a,s,i,r){try{var c=e[i](r),o=c.value}catch(e){return void n(e)}c.done?t(o):Promise.resolve(o).then(a,s)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function m(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(n,!0).forEach(function(e){p(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?E(e):t}s=s&&s.hasOwnProperty("default")?s.default:s,a=a&&a.hasOwnProperty("default")?a.default:a,r=r&&r.hasOwnProperty("default")?r.default:r;function N(){var e=wpChimpInlineState.restApiUrl;return"undefined"!=typeof wpChimpInlineState&&!(void 0===e||!/\/wp-json\//.test(e))}var S={subscriptionForms:[],notice:{status:null,message:null}},x={fetchFromAPI:function(e){return{type:"FETCH_FROM_API",path:e}},postToAPI:function(e,t){return{type:"POST_TO_API",path:e,body:t}},setAll:function(e){return{type:"SET_ALL",subscriptionForms:e}},setItem:function(e){return{type:"SET_ITEM",item:e}},setIsSaving:function(e){return{type:"SET_STATUS",status:{isSaving:e}}},unSetNotice:function(){return{type:"SET_NOTICE",notice:{status:null,message:null}}},setNotice:function(e,t){return{type:"SET_NOTICE",notice:{status:e,message:t}}},saveItem:regeneratorRuntime.mark(function e(t){var n,a,s,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={},a=Object.keys(t.attributes),s=0;case 3:if(!(s<a.length)){e.next=12;break}if(i=a[s],d.has(t.attributes,i)){e.next=7;break}return e.abrupt("continue",9);case 7:"list_id"===i&&(n[i]=t.attributes[i]),d.has(t.attributes[i],"value")&&(n[i]=t.attributes[i].value);case 9:s++,e.next=3;break;case 12:return e.next=14,x.postToAPI("/wp-chimp/v1/subscription-forms/".concat(n.list_id),n);case 14:return r=e.sent,e.abrupt("return",x.setItem(r));case 16:case"end":return e.stop()}},e)})},C={FETCH_FROM_API:function(e){return s({path:e.path})},POST_TO_API:function(e){return s({path:e.path,method:"POST",body:JSON.stringify(e.body)})}},P={getAll:regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fetchFromAPI("/wp-chimp/v1/subscription-forms");case 2:return t=e.sent,e.abrupt("return",x.setAll(t));case 4:case"end":return e.stop()}},e)}),getItem:regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.fetchFromAPI("/wp-chimp/v1/subscription-forms/".concat(t));case 2:return n=e.sent,e.abrupt("return",x.setItem(n));case 4:case"end":return e.stop()}},e)})},T=(e.registerStore("wp-chimp/subscription-forms",{reducer:function(e,t){var n=0<arguments.length&&void 0!==e?e:S,a=1<arguments.length?t:void 0;switch(a.type){case"SET_ALL":return v({},n,{subscriptionForms:a.subscriptionForms});case"SET_ITEM":return d.includes(d.map(n.subscriptionForms,"list_id"),a.item.list_id)?v({},n,{subscriptionForms:n.subscriptionForms.map(function(e){return e.list_id===a.item.list_id?v({},a.item):e})}):(n.subscriptionForms.push(a.item),v({},n,{subscriptionForms:n.subscriptionForms}));case"SET_STATUS":return v({},n,{},a.status);case"SET_NOTICE":return v({},n,{notice:a.notice})}return n},actions:x,selectors:{getAll:function(e){return e.subscriptionForms||{}},getItem:function(e,t){for(var n,a=0;a<e.subscriptionForms.length;a++)e.subscriptionForms[a].list_id===t&&(n=e.subscriptionForms[a]);return n||{}},getStatus:function(e){return{isSaving:e.isSaving}},getNotice:function(e){return{notice:e.notice}}},controls:C,resolvers:P}),function(e){return 1==e%2});function O(){for(var e=[],t=0;t<window.sessionStorage.length;t++)-1<window.sessionStorage.key(t).indexOf("wp_chimp_lists_page_")&&e.push(window.sessionStorage.key(t));if(0<e.length)for(var n=0;n<e.length;n++)window.sessionStorage.removeItem(e[n])}var I=h.createContext(),k=I.Provider,F=I.Consumer,D=wpChimpInlineState,A=D.wpRestNonce,M=D.mailchimpApiStatus,j=D.listsInit,L=D.listsPerPage,R=function(){function t(e){var r;return c(this,t),p(E(r=y(this,w(t).call(this,e))),"state",{fetching:!1,syncing:!1,lists:[],listsPage:1,listsTotal:0,listsTotalPages:0,pageNext:0,pagePrev:0,detailId:"",modalId:""}),p(E(r),"fetchLists",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=function(e){var t="wp_chimp_lists_page_".concat(e),n=window.sessionStorage.getItem(t);return null!==n&&(n=JSON.parse(n)),n&&d.has(n,"lists")?n:null}(d.has(e,"query")&&e.query.page?e.query.page:1);if(r.state.syncing||!t)(e=v({beforeSend:function(){return r.setState({fetching:!0})},path:"/wp-chimp/v1/lists",headers:{"X-WP-Nonce":A},query:{page:r.state.listsPage,per_page:L},parse:!1},e)).path&&(e.path=i.addQueryArgs(e.path,{page:e.query.page,per_page:e.query.per_page})),d.has(e,"beforeSend")&&e.beforeSend(),s(v({},e)).then(r.handleSuccess).then(r.handleResponse).catch(function(){return r.setState({fetching:!1,syncing:!1})});else{var n=parseInt(1<t.listsPage?t.listsPage-1:0,10),a=parseInt(t.listsPage<t.listsTotalPages?t.listsPage+1:0,10);r.setState(v({},t,{pageNext:a,pagePrev:n}))}}),p(E(r),"syncLists",function(){r.state.syncing||(O(),r.fetchLists({path:"/wp-chimp/v1/sync/lists",beforeSend:function(){return r.setState({syncing:!0})}}))}),p(E(r),"handleSuccess",function(e){return r.setState({fetching:!1,syncing:!1}),204===e.status?null:200<=e.status&&e.status<300?e.json?e:Promise.reject(e):void 0}),p(E(r),"handleResponse",function(e){var t=parseInt(e.headers.get("X-WP-Chimp-Lists-Page"),10),n=parseInt(e.headers.get("X-WP-Chimp-Lists-Total"),10),a=parseInt(e.headers.get("X-WP-Chimp-Lists-TotalPages"),10),s=parseInt(1<t?t-1:0,10),i=parseInt(t<a?t+1:0,10);e.json().then(function(e){!function(e,t){var n="wp_chimp_lists_page_".concat(e);null===window.sessionStorage.getItem(n)&&window.sessionStorage.setItem(n,JSON.stringify(t))}(t,{lists:e,listsPage:t,listsTotal:n,listsTotalPages:a}),r.setState({lists:e,listsPage:t,listsTotal:n,listsTotalPages:a,pageNext:i,pagePrev:s})})}),r}return b(t,h.Component),m(t,[{key:"componentDidMount",value:function(){M&&N()&&(!1===j?this.syncLists():this.fetchLists(),this.props.syncButtonDOM.addEventListener("click",this.syncLists),window.addEventListener("beforeunload",O))}},{key:"render",value:function(){var t=this;return h.createElement(k,{value:v({},this.state,{toggleListDetail:function(e){return t.setState({detailId:t.state.detailId===e?"":e})},toggleModal:function(e){return t.setState({modalId:t.state.modalId===e?"":e})},navigateToPage:function(e){!Number.isInteger(e)||e<=0||t.fetchLists({query:{page:e,per_page:L}})}})},this.props.children)}}]),t}();function B(e){var t=e.status?"yes":"no-alt";return h.createElement("span",u({},e,{className:"dashicons dashicons-".concat(t," wp-chimp-icon-bool wp-chimp-icon-bool--").concat(t)}))}var U=wpChimpInlineState.mailchimpApiDc;function q(e){var t=e.nth,n=e.item,a=e.empty,s=e.onToggleDetail,i=e.onToggleModal,r=e.isDetail,c=(n||{}).stats||{},o=c.member_count;if(a)return h.createElement("tr",{className:"wp-chimp-table__tr wp-chimp-table__tr--odd"},h.createElement("td",{colSpan:"5",height:"16"},_.__("No MailChimp Lists found.","wp-chimp")));var l,m=Object.keys(c||{}).length,p=n.marketing_permissions?h.createElement("span",{className:"row-gdpr"},"GDPR"):null,u=h.createElement("span",{className:"row-title"},n.name);return!d.isUndefined(o)&&1<m&&(u=h.createElement("span",{className:"row-title".concat(1<m?" has-stats":""),onClick:s},n.name),l=h.createElement(f.Tooltip,{text:_.__("View Detail","wp-chimp")},h.createElement(f.Button,{isDefault:!0,isSmall:!0,onClick:s},h.createElement(f.Dashicon,{icon:r?"arrow-up-alt2":"arrow-down-alt2",size:"14"})))),h.createElement(h.Fragment,null,h.createElement("tr",{className:"wp-chimp-table__tr".concat(T(t)?" wp-chimp-table__tr--odd":"")},h.createElement("td",{className:"wp-chimp-table__td td-list-id"},h.createElement("code",{className:"wp-chimp-code-inline"},n.list_id)),h.createElement("td",{className:"wp-chimp-table__td td-name"},h.createElement("h3",null,u,p)),h.createElement("td",{className:"wp-chimp-table__td td-suscribers"},o),h.createElement("td",{className:"wp-chimp-table__td td-double-optin"},h.createElement(B,{status:n.double_optin})),h.createElement("td",{className:"wp-chimp-table__td td-actions"},h.createElement(f.ButtonGroup,{className:"wp-chimp-button-group".concat(1<m?" has-third-button":"")},h.createElement(f.Tooltip,{text:_.__("Subscription Form Tool","wp-chimp")},h.createElement(f.Button,{isDefault:!0,isSmall:!0,onClick:i},h.createElement(f.Dashicon,{icon:"feedback",size:"14"}))),h.createElement(f.Tooltip,{text:_.__("View in MailChimp","wp-chimp")},h.createElement(f.Button,{isDefault:!0,isSmall:!0,href:"https://".concat(U,".admin.mailchimp.com/lists/members/?id=").concat(n.web_id),target:"_blank",rel:"external noopener noreferrer"},h.createElement(f.Dashicon,{icon:"external",size:"14"}))),l))))}function V(e){return h.createElement("input",u({},e,{className:"wp-chimp-input wp-chimp-input--readonly",readOnly:!0}))}var W=function(){function n(e){var t;return c(this,n),p(E(t=y(this,w(n).call(this,e))),"state",{copied:!1}),t.copiedTimeout,t}return b(n,h.Component),m(n,[{key:"componentDidMount",value:function(){var t=this;this.clipboard=new a(this.button),this.clipboard.on("success",function(e){clearTimeout(t.copiedTimeout),t.setState({copied:!0}),t.copiedTimeout=setTimeout(function(){return t.setState({copied:!1})},3e3),e.clearSelection()})}},{key:"componentWillUnmount",value:function(){this.clipboard.destroy()}},{key:"render",value:function(){var t=this,e=this.props.clipboardText;return h.createElement(f.Tooltip,{text:this.state.copied?_.__("Copied","wp-chimp"):_.__("Copy the shortcode","wp-chimp")},h.createElement(f.Button,{ref:function(e){t.button=e},isDefault:!0,"data-clipboard-text":e},h.createElement(f.Dashicon,{icon:this.state.copied?"yes":"clipboard",size:"14"})))}}]),n}(),H=function(){function n(e){var t;return c(this,n),p(E(t=y(this,w(n).call(this,e))),"state",{activeTabIndex:0}),p(E(t),"handleTabClick",function(e){t.setState({activeTabIndex:e})}),t}return b(n,h.Component),m(n,[{key:"render",value:function(){var n=this,e=[];if(this.props.children&&!Array.isArray(this.props.children)?e.push(this.props.children):e=this.props.children,e.length<1)return null;var t;return t=e.map(function(e,t){return e&&e.props.name?h.createElement("li",{key:t,className:"wp-chimp-list-detail-tabs__menu-item".concat(t===n.state.activeTabIndex?" active":""),onClick:function(){return n.handleTabClick(t)}},e.props.name):null}),h.createElement(h.Fragment,null,h.createElement("div",{className:"wp-chimp-list-detail-tabs"},0<t.length&&h.createElement(h.Fragment,null,h.createElement("ul",{className:"wp-chimp-list-detail-tabs__menu"},t),h.createElement("div",{className:"wp-chimp-list-detail-tabs__content"},e[this.state.activeTabIndex]))))}}]),n}();function J(e){var t=e.data,n=Number.parseFloat(t.open_rate).toFixed(2),a=Number.parseFloat(t.click_rate).toFixed(2),s=Number.parseFloat(t.avg_sub_rate).toFixed(2),i=Number.parseFloat(t.avg_unsub_rate).toFixed(2);return h.createElement(h.Fragment,null,h.createElement("div",{className:"stats-section stats-section-overview"},h.createElement("div",{className:"stats-section-overview__item"},h.createElement("div",{className:"stats-count"},t.member_count),h.createElement("div",{className:"stats-label"},_.__("Subscribed Contacts","wp-chimp"))),h.createElement("div",{className:"stats-section-overview__item"},h.createElement("div",{className:"stats-count"},t.unsubscribe_count),h.createElement("div",{className:"stats-label"},_.__("Unsubscribed Contacts","wp-chimp"))),h.createElement("div",{className:"stats-section-overview__item"},h.createElement("div",{className:"stats-count"},t.cleaned_count),h.createElement("div",{className:"stats-label"},_.__("Cleaned Contacts","wp-chimp")))),h.createElement("div",{className:"stats-section stats-section-list-performance"},h.createElement("div",{className:"stats-section-list-performance__item"},h.createElement("div",{className:"stats-section-list-performance__item-data"},h.createElement("h5",{className:"stats-title"},_.__("Average Open Rate","wp-chimp")),h.createElement("div",{className:"stats-count"},"".concat(n,"%"))),h.createElement("div",{className:"stats-meter"},h.createElement("div",{className:"stats-meter__bar",style:{width:"".concat(Math.round(n),"%")}}))),h.createElement("div",{className:"stats-section-list-performance__item"},h.createElement("div",{className:"stats-section-list-performance__item-data"},h.createElement("h5",{className:"stats-title"},_.__("Average Click Rate","wp-chimp")),h.createElement("div",{className:"stats-count"},"".concat(a,"%"))),h.createElement("div",{className:"stats-meter"},h.createElement("div",{className:"stats-meter__bar",style:{width:"".concat(Math.round(a),"%")}}))),h.createElement("div",{className:"stats-section-list-performance__item"},h.createElement("div",{className:"stats-section-list-performance__item-data"},h.createElement("h5",{className:"stats-title"},_.__("Average Subscribe Rate","wp-chimp")),h.createElement("div",{className:"stats-count"},"".concat(s,"%"))),h.createElement("div",{className:"stats-meter"},h.createElement("div",{className:"stats-meter__bar",style:{width:"".concat(Math.round(s),"%")}}))),h.createElement("div",{className:"stats-section-list-performance__item"},h.createElement("div",{className:"stats-section-list-performance__item-data"},h.createElement("h5",{className:"stats-title"},_.__("Average Unsubscribe Rate","wp-chimp")),h.createElement("div",{className:"stats-count"},"".concat(i,"%"))),h.createElement("div",{className:"stats-meter"},h.createElement("div",{className:"stats-meter__bar",style:{width:"".concat(Math.round(i),"%")}})))))}function z(e){var t=e.nth,n=e.item,a=e.isDetail,s=e.onToggleDetail,i=n||{},r=i.list_id,c=i.stats,o="wp-chimp-table",l="wp-chimp-list-detail-footer",m="wp-chimp-list-detail-shortcode";return a?h.createElement("tr",{className:"".concat(o,"__tr").concat(T(t)?" ".concat(o,"__tr--odd"):""," wp-chimp-list-detail")},h.createElement("td",{className:"".concat(o,"__td td-detail"),colSpan:"5"},h.createElement(H,null,h.createElement(J,{name:_.__("Stats","wp-chimp"),data:c||{}})),h.createElement("div",{className:"".concat(l)},h.createElement("div",{className:"".concat(l,"__item wp-chimp-list-detail-close")},h.createElement(f.Button,{isDefault:!0,onClick:s},_.__("Close","wp-chimp"))),h.createElement("div",{className:"".concat(l,"__item ").concat(m)},h.createElement("label",{className:"".concat(m,"__label"),htmlFor:"wp-chimp-list-shortcode-".concat(r)},_.__("Shortcode","wp-chimp")),h.createElement(V,{className:"".concat(m,"__content"),id:"wp-chimp-list-shortcode-".concat(r),value:'[wp-chimp list_id="'.concat(r,'"]')}),h.createElement(W,{className:"".concat(m,"__button"),clipboardText:'[wp-chimp list_id="'.concat(r,'"]')}))))):null}function X(e){var a=e.attributes,s=e.onChange,i=e.onFocus;return Object.keys(d.isObject(a)&&!d.isEmpty(a)?a:[]).map(function(t){var e="wp-chimp-subscription-form-control",n=null;switch(a[t].editor_type){case"text":n=h.createElement(f.TextControl,{className:"".concat(e," ").concat(e,"-text"),label:a[t].label,value:a[t].value?a[t].value:"",help:a[t].description?a[t].description:"",onChange:function(e){return s(e,t)},onFocus:function(){return i(t)}});break;case"textarea":case"richtext":n=h.createElement(f.TextareaControl,{className:"".concat(e," ").concat(e,"-textarea"),name:t,label:a[t].label,value:a[t].value?a[t].value:"",help:a[t].description?a[t].description:"",onChange:function(e){return s(e,t)},onFocus:function(){return i(t)}})}return n})}function G(e){var t=e.list_id;return h.createElement("div",{key:"form-undefined",className:"wp-chimp-notice wp-chimp-notice--error"},h.createElement(h.RawHTML,{key:"form-undfined-content",className:"wp-chimp-notice__content"},_.sprintf(_.__("One or some of the required data property, such as the %s, %s, and %s text, could not be retrieved from the selected MailChimp List. Please head to %s, and verify that the selected MailChimp List, %s, is actually present on this site.","wp-chimp"),"<strong>".concat(_.__("Heading","wp-chimp"),"</strong>"),"<strong>".concat(_.__("Email Placeholder","wp-chimp"),"</strong>"),"<strong>".concat(_.__("Button","wp-chimp"),"</strong>"),'<a href="'.concat(Y,'" target="_blank" class="wp-chimp-notice__url">').concat(_.__("the Settings page","wp-chimp"),"</a>"),"<code>".concat(t,"</code>"))))}var K=t.compose(e.withSelect(function(e){return v({},(0,e("wp-chimp/subscription-forms").getNotice)()||{})}),e.withDispatch(function(e){return{unSetNotice:e("wp-chimp/subscription-forms").unSetNotice}}))(function(e){var t=e.notice,n=e.className,a=e.unSetNotice,s=t.status,i=t.message;return s&&i&&h.createElement(f.Notice,{status:s,onRemove:a,className:"".concat(n,"-notice")},i)}),Y=wpChimpInlineState.settingsUrl,Q=function(){function e(){return c(this,e),y(this,w(e).apply(this,arguments))}return b(e,h.Component),m(e,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.attributes,a=e.marketing_permissions,s=n||{},i=s.text_heading,r=s.text_sub_heading,c=s.text_email_placeholder,o=s.text_marketing_permissions,l=s.text_button,m=s.text_footer;return d.isUndefined(n)||d.some(n,d.isUndefined)?h.createElement(G,this.props.attributes):h.createElement("div",{className:"".concat(t)},h.createElement("header",{className:"".concat(t,"__header")},h.createElement("h3",{className:"".concat(t,"__heading")},!d.isEmpty(i.value)&&i.value),!d.isEmpty(r.value)&&h.createElement("div",{className:"".concat(t,"__sub-heading")},r.value)),h.createElement("div",{className:"".concat(t,"__form wp-chimp-form")},h.createElement("div",{className:"wp-chimp-form-fields"},h.createElement("input",{className:"wp-chimp-form-fields__item wp-chimp-form-fields-email",type:"email",placeholder:!d.isEmpty(c.value)&&c.value,disabled:!0}),!0===a&&!d.isEmpty(o.value)&&h.createElement("div",{className:"wp-chimp-form-fields__item wp-chimp-form-fields-checkbox"},h.createElement("input",{type:"checkbox",id:"".concat(n.list_id,"_marketing_permissions")}),h.createElement("label",{htmlFor:"".concat(n.list_id,"_marketing_permissions")},o.value))),h.createElement("button",{className:"wp-chimp-form-button",type:"button"},!d.isEmpty(l.value)&&l.value)),!d.isEmpty(m.value)&&h.createElement("div",{className:"".concat(t,"__footer")},m.value))}}]),e}();function Z(){return h.createElement(r,{ariaLabel:_.__("Loading Subscription Form Preview","wp-chimp"),height:250,width:640,speed:2,preserveAspectRatio:"xMaxYMin slice",primaryColor:"#edeff0",secondaryColor:"#d7dade",style:{width:"100%",maxWidth:"640px",height:"100%",maxHeight:"250px"}},h.createElement("rect",{x:"25",y:"35",width:"180",height:"18"}),h.createElement("rect",{x:"25",y:"63",width:"560",height:"18"}))}function $(){return h.createElement(r,{ariaLabel:_.__("Loading Preview Controls","wp-chimp"),height:250,width:300,speed:2,preserveAspectRatio:"xMaxYMin slice",primaryColor:"#edeff0",secondaryColor:"#d7dade",style:{width:"100%",maxWidth:"300px",height:"100%",maxHeight:"250px"}},h.createElement("rect",{x:"0",y:"0",width:"180",height:"18"}),h.createElement("rect",{x:"0",y:"28",width:"300",height:"28"}))}function ee(e){var t=e.preview,n=e.className;return h.createElement("div",{className:n},d.isObject(t)&&!d.isEmpty(t)?h.createElement(Q,u({className:"wp-chimp-subscription-form"},t)):h.createElement(Z,null))}var te=t.compose(e.withSelect(function(e){return v({},(0,e("wp-chimp/subscription-forms").getStatus)())}),e.withDispatch(function(e,t){var n,a=t.onSave,s=e("wp-chimp/subscription-forms"),i=s.saveItem,r=s.setIsSaving,c=s.setNotice;return{onSave:(n=function(c){return function(){var e=this,r=arguments;return new Promise(function(t,n){var a=c.apply(e,r);function s(e){o(a,t,n,s,i,"next",e)}function i(e){o(a,t,n,s,i,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r(!0),e.next=3,i(a());case 3:t=e.sent,r(!1),t?c("success",_.__("Settings saved.","wp-chimp")):c("error",_.__("An unexpected error has occured.","wp-chimp"));case 6:case"end":return e.stop()}},e)})),function(){return n.apply(this,arguments)})}}))(function(e){var t=e.isSaving,n=e.onSave;return h.createElement(f.Button,{isPrimary:!0,isBusy:t,onClick:n},t?_.__("Saving Changes...","wp-chimp"):_.__("Save Changes","wp-chimp"))}),ne="wp-chimp-modal",ae="wp-chimp-subscription-form-tool",se=function(){function t(e){var n;return c(this,t),p(E(n=y(this,w(t).call(this,e))),"state",{focus:null}),p(E(n),"handleValueChange",function(e,t){n.setState(p({},t,e))}),p(E(n),"handleFocusState",function(e){n.setState({focus:e})}),n}return b(t,h.Component),m(t,[{key:"withStateAttributes",value:function(e){if(!d.isUndefined(e.attributes)){var t=d.cloneDeep(e);for(var n in this.state)if(d.has(t.attributes,n)){var a=d.has(this.state,n)?this.state[n]:"";t.attributes[n].value=a}return t}}},{key:"render",value:function(){var e=this.props,t=e.list,n=e.onClose,a=t.name,s=t.marketing_permissions,i=this.withStateAttributes(this.props.subscriptionForm),r=["text_email_placeholder"];return!0===s&&r.push("text_marketing_permissions"),h.createElement(f.Modal,{title:a,onRequestClose:n,contentLabel:_.__("Subscription Form Tool","wp-chimp"),className:ne,overlayClassName:"".concat(ne,"-overlay"),shouldCloseOnClickOutside:!0},h.createElement("div",{className:"".concat(ne,"__content ").concat(ae)},h.createElement("div",{className:"".concat(ne,"-main")},h.createElement("h2",{className:"screen-reader-text"},_.__("Subscription Form Preview","wp-chimp")),h.createElement(K,{className:ne}),h.createElement(ee,{className:"".concat(ae,"__preview"),preview:i})),h.createElement("div",{className:"".concat(ne,"-sidebar")},h.createElement("h2",{className:"screen-reader-text"},_.__("Subscription Form Editor","wp-chimp")),h.createElement("div",{className:"".concat(ae,"__editor")},d.isObject(i)&&d.isObject(i.attributes)&&0<d.size(i)&&0<d.size(i.attributes)?h.createElement(h.Fragment,null,h.createElement(X,{attributes:d.pick(i.attributes,["text_heading","text_sub_heading"]),onChange:this.handleValueChange,onFocus:this.handleFocusState}),h.createElement(X,{attributes:d.pick(i.attributes,r),onChange:this.handleValueChange,onFocus:this.handleFocusState}),h.createElement(X,{attributes:d.pick(i.attributes,["text_button","text_footer"]),onChange:this.handleValueChange,onFocus:this.handleFocusState}),h.createElement(f.Panel,{className:"".concat(ae,"__panel")},h.createElement(f.PanelBody,{title:_.__("Notices","wp-chimp"),initialOpen:!1,className:"".concat(ae,"__panel-body")},h.createElement(f.PanelRow,{className:"".concat(ae,"__panel-row")},h.createElement(X,{attributes:d.pickBy(i.attributes,function(e,t){return d.startsWith(t,"text_notice_")})}))))):h.createElement($,null)))),h.createElement("div",{className:"".concat(ne,"__footer")},h.createElement(f.Button,{isDefault:!0,onClick:n},_.__("Cancel","wp-chimp")),h.createElement(te,{onSave:function(){return i}})))}}]),t}(),ie=t.compose(e.withSelect(function(e,t){var n=t.list,a=e("wp-chimp/subscription-forms"),s=a.getItem,i=a.getStatus;return v({subscriptionForm:s(n.list_id)},i())}),e.withDispatch(function(e,t){var n=t.onToggleModal,a=e("wp-chimp/subscription-forms").unSetNotice;return{onClose:function(){n(),a()}}}))(se),re=function(){function i(){var e,a;c(this,i);for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return p(E(a=y(this,(e=w(i)).call.apply(e,[this].concat(n)))),"state",{value:1}),p(E(a),"componentDidUpdate",function(e){a.props.page!==e.page&&a.setState({value:a.props.page})}),p(E(a),"handleInputChange",function(e){a.setState({value:a.handleInputValue(e.target.value)})}),p(E(a),"handleInputKeyPress",function(e){return 13===(e.which||e.keyCode)&&e.preventDefault(),a.handleInputValue(e.target.value)}),p(E(a),"handleInputValue",function(e){var t=a.props.maxPage,n=parseInt(e,10);return n<1?1:t<n?t:1<=n&&n<=t?n:""}),a}return b(i,h.Component),m(i,[{key:"render",value:function(){var t=this,n=this.props.navigateHandler;return h.createElement("input",{className:"current-page",type:"text",size:"3","aria-describedby":"table-paging",value:this.state.value,onChange:this.handleInputChange,onKeyPress:function(e){return n(t.handleInputKeyPress(e))}})}}]),i}();function ce(e){var t=e.navigate,n=e.page,a=e.children;return 0===n?h.createElement("span",{className:"tablenav-pages-navspan button disabled","aria-hidden":"true"},a):h.createElement("button",u({type:"button"},e,{className:"button ".concat(t,"-page").concat(0===n?" inactive":"")}),a)}function oe(){return h.createElement(F,null,function(e){var t=e.navigateToPage,n=e.listsPage,a=e.listsTotal,s=e.listsTotalPages,i=e.pageNext,r=e.pagePrev;return s<2?null:h.createElement("div",{className:"tablenav"},h.createElement("div",{className:"tablenav-pages",id:"wp-chimp-table-pagination"},h.createElement("span",{className:"displaying-num"},"".concat(a," ").concat(_._nx("item","items",a,"Table pagination: denoting the lists number, e.g. 10 items","wp-chimp"))),h.createElement(ce,{navigate:"prev",page:r,onClick:function(){return t(r)}},"‹"),h.createElement("span",{className:"paging-input"},h.createElement("label",{className:"screen-reader-text",htmlFor:"current-page-selector"},_.__("Current Page","wp-chimp")),h.createElement(re,{page:n,maxPage:s,navigateHandler:function(e){return t(e)}}),h.createElement("span",{className:"tablenav-paging-text"},_.__("of","wp-chimp"),h.createElement("span",{className:"total-pages"},s))),h.createElement(ce,{navigate:"next",page:i,onClick:function(){return t(i)}},"›")))})}function le(e){var t=e.colSpan,n=e.height,a=e.children;return h.createElement("td",{colSpan:t,height:n},h.createElement("div",{className:"wp-chimp-spinner spinner"})," ",a)}function me(e){for(var t=e.colSpan,n=[],a=0;a<t;a++)n.push(h.createElement("td",{className:"wp-chimp-table-td-placeholder td-placeholder",key:a},h.createElement(r,{ariaLabel:_.__("Loading table data","wp-chimp"),height:12,width:100,speed:2,preserveAspectRatio:"xMaxYMin slice",primaryColor:"#edeff0",secondaryColor:"#d7dade",style:{width:"100%",height:"".concat(12,"px")}},h.createElement("rect",{x:"0",y:"0",width:100,height:12}))));return n}var pe=wpChimpInlineState,ue=pe.wpRestNonce,he=pe.mailchimpApiStatus,de=pe.restApiUrl,_e=pe.listsInit,fe=h.createContext(),ge=fe.Provider,ve=fe.Consumer,be=function(){function t(e){var s;return c(this,t),p(E(s=y(this,w(t).call(this,e))),"state",{pinging:!1,pingStatus:{}}),p(E(s),"onPingAlways",function(e){var t=e.connected,n=e.title;t&&s.props.syncButtonDOM.removeAttribute("disabled");var a={pinged:!0,connected:t,title:n};!function(e,t){var n=60*t*1e3,a={value:JSON.stringify(e),timestamp:(new Date).getTime()+n};window.sessionStorage.setItem("wp_chimp_mailchimp_api_status",JSON.stringify(a))}(a,.5),s.setState({pinging:!1,pingStatus:a})}),s}return b(t,h.Component),m(t,[{key:"componentDidMount",value:function(){var e=this;if(he&&N()){var t=function(){var e=JSON.parse(window.sessionStorage.getItem("wp_chimp_mailchimp_api_status"));return!!e&&((new Date).getTime()>e.timestamp?(window.sessionStorage.removeItem("wp_chimp_mailchimp_api_status"),!1):JSON.parse(e.value))}();t.connected&&_e&&this.props.syncButtonDOM.removeAttribute("disabled"),t&&_e?this.setState({pingStatus:t}):jQuery.ajax({type:"GET",headers:{"X-WP-Nonce":ue},url:"".concat(de,"/ping"),beforeSend:function(){return e.setState({pinging:!0})}}).always(this.onPingAlways)}}},{key:"render",value:function(){return h.createElement(ge,{value:v({},this.state)},this.props.children)}}]),t}();var we=document.querySelector("#wp-chimp-lists"),Ee=document.querySelector("#wp-chimp-mailchimp-api-status"),ye=document.querySelector("#wp-chimp-sync-lists-button");d.isElement(we)&&h.render(h.createElement(R,{syncButtonDOM:ye},h.createElement(function(){var m="wp-chimp-table";return h.createElement(F,null,function(e){var t,n,a=e.toggleListDetail,s=e.toggleModal,i=e.detailId,r=e.modalId,c=e.fetching,o=e.syncing,l=e.lists;return t=0<l.length?l.map(function(e,t){var n={nth:t+1,item:e};return h.createElement(h.Fragment,{key:e.list_id},h.createElement(q,u({},n,{onToggleDetail:function(){return a(e.list_id)},onToggleModal:function(){return s(e.list_id)},isDetail:i===e.list_id})),i?h.createElement(z,u({},n,{onToggleDetail:function(){return a(e.list_id)},isDetail:i===e.list_id})):null)}):h.createElement(q,{empty:!0}),o&&(n=h.createElement("tr",{className:"".concat(m,"__tr ").concat(m,"__tr--odd")},h.createElement(le,{colSpan:"5",height:"16"},_.__("Please wait while we are syncing the Lists data from MailChimp...","wp-chimp")))),c&&(n=h.createElement("tr",{className:"".concat(m,"__tr ").concat(m,"__tr--odd")},h.createElement(me,{colSpan:"5",height:"16"}))),h.createElement(h.Fragment,null,h.createElement("table",{className:"widefat ".concat(m),id:"".concat(m,"-lists")},h.createElement("thead",null,h.createElement("tr",null,h.createElement("th",{scope:"col",className:"".concat(m,"__th th-list-id")},_.__("ID","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-name")},_.__("Name","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-subscribers")},_.__("Subscribers","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-double-optin")},_.__("Double Opt-in","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-actions")},_.__("Actions","wp-chimp")))),h.createElement("tbody",null,o||c?n:t),h.createElement("tfoot",null,h.createElement("tr",null,h.createElement("th",{scope:"col",className:"".concat(m,"__th th-list-id")},_.__("ID","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-name")},_.__("Name","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-subscribers")},_.__("Subscribers","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-double-optin")},_.__("Double Opt-in","wp-chimp")),h.createElement("th",{scope:"col",className:"".concat(m,"__th th-actions")},_.__("Actions","wp-chimp"))))),h.createElement(oe,null),!d.isEmpty(r)&&h.createElement(ie,{onToggleModal:function(){return s(r)},list:l.find(function(e){return e.list_id===r})}))})},null)),we),d.isElement(Ee)&&h.render(h.createElement(be,{syncButtonDOM:ye},h.createElement(function(){return h.createElement(ve,null,function(e){var t=e.pingStatus,n=e.pinging,a="wp-chimp-mailchimp-api-status-light",s=t.title||_.__("Oops! an unexpected error occured.","wp-chimp");return h.createElement(h.Fragment,null,h.createElement("span",{className:"".concat(a," ").concat(a).concat(t.connected?"--connected":"--disconnected")}),h.createElement("span",null,n?_.__("Connecting..."):s))})},null)),Ee)}(wp.element,lodash,wp.data,wp.apiFetch,wp.url,wp.i18n,wp.components,ClipboardJS,wp.compose,ContentLoader)}();
//# sourceMappingURL=tab-mailchimp.min.js.map
